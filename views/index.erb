<!-- NAV -->
<header class="max-w-2xl mx-auto px-6 pt-8 pb-0 flex items-center justify-between">
  <a href="#" class="font-mono text-sm font-medium text-blue-600 tracking-tight focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">SHABBAT.md</a>
  <nav aria-label="Main navigation" class="flex items-center gap-6 text-sm text-gray-500">
    <a href="#format"   class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">Format</a>
    <a href="#psak"     class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">Psak</a>
    <a href="#melachot" class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">Melachot</a>
    <a href="https://github.com/mitchellbernstein/shabbat.md" target="_blank" rel="noopener" class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">GitHub</a>
  </nav>
</header>

<!-- HERO -->
<section class="max-w-2xl mx-auto px-6 pt-20 pb-16">
  <h1 class="text-4xl font-semibold tracking-tight text-gray-900 mb-4">
    SHABBAT.md
  </h1>
  <p class="text-gray-500 mb-2">Make Agents Kosher Again.</p>
  <p class="text-gray-500 mb-10 max-w-lg">
    An open format for declaring Shabbat and Yom Tov compliance settings for AI coding agents.
    Because your tools should rest when you do.
  </p>
  <div class="flex gap-4 text-sm">
    <a href="#format" class="bg-blue-600 text-white px-4 py-2 rounded-md hover:bg-blue-700 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2">
      View the format
    </a>
    <a href="https://github.com/mitchellbernstein/shabbat.md" target="_blank" rel="noopener"
       class="text-gray-500 hover:text-blue-600 transition-colors px-4 py-2 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">
      GitHub →
    </a>
  </div>
</section>

<!-- ORIGIN -->
<section class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">Origin</p>

  <blockquote class="mb-8">
    <p class="mb-2 text-gray-700">"Can a Jew let his agent run over Shabbat if the last prompt was Friday afternoon?"</p>
    <footer class="text-sm text-gray-500">— <cite class="font-mono not-italic">@jacob_posel</cite></footer>
  </blockquote>

  <blockquote class="mb-10">
    <p class="mb-2 text-gray-700">"If the agent is assuming your identity, no, but if it's openclaw style with its
    own identity on its own machine should be fine."</p>
    <footer class="text-sm text-gray-500">— <cite class="font-mono not-italic">@levie</cite></footer>
  </blockquote>

  <p class="text-gray-500 text-sm max-w-lg leading-relaxed">
    @levie's reply is a precise application of <em>amirah l'akum</em> and <em>grama</em> —
    two foundational halachic principles governing indirect labor.
    SHABBAT.md makes this determination automatic.
  </p>
</section>

<!-- FORMAT -->
<section id="format" class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">The Format</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-3">What SHABBAT.md looks like</h2>
  <p class="text-gray-500 text-sm mb-8 max-w-lg">
    Place a <code class="font-mono text-gray-700">SHABBAT.md</code> at the root of your repo.
    Shabbat-aware agents read it to determine what they may do — and when.
  </p>

  <div class="code-block mb-10">
    <pre><span class="comment"># SHABBAT.md</span>

<span class="section">## Agent Identity</span>
<span class="key">- identity_type:</span> <span class="val-str">service-account</span>   <span class="comment"># "service-account" | "user-proxy"</span>
<span class="key">- credentials:</span>   <span class="val-str">dedicated</span>

<span class="section">## Shabbat Schedule</span>
<span class="key">- timezone:</span>       <span class="val-str">America/New_York</span>
<span class="key">- pause_trigger:</span>  <span class="val-str">shkia</span>             <span class="comment"># or "candle-lighting" or ISO 8601</span>
<span class="key">- resume_trigger:</span> <span class="val-str">havdalah</span>
<span class="key">- observe_yom_tov:</span> <span class="val-bool">true</span>

<span class="section">## Permitted Actions</span>
<span class="key">- read</span>        <span class="comment"># queries, browsing, fetching</span>
<span class="key">- summarize</span>   <span class="comment"># synthesis of existing data</span>
<span class="key">- monitor</span>     <span class="comment"># watch and log, no alerting</span>

<span class="section">## Forbidden Actions</span>
<span class="key">- write</span>        <span class="comment"># disk, DB, external systems  (Kotev)</span>
<span class="key">- deploy</span>       <span class="comment"># infra, releases             (Boneh)</span>
<span class="key">- delete</span>       <span class="comment"># files, records              (Mochek)</span>
<span class="key">- communicate</span>  <span class="comment"># email, Slack, SMS as user</span>
<span class="key">- transact</span>     <span class="comment"># billing, payments           (Mekach u'memkar)</span>
<span class="key">- commit</span>       <span class="comment"># git commits                 (Kotev)</span>

<span class="section">## Human-in-the-Loop</span>
<span class="key">- pause_hitl_on_shabbat:</span> <span class="val-bool">true</span>

<span class="section">## Pikuach Nefesh</span>
<span class="key">- life_safety_override:</span> <span class="val-bool">false</span>   <span class="comment"># true for medical/emergency systems</span>

<span class="section">## Havdalah Audit</span>
<span class="key">- audit_enabled:</span> <span class="val-bool">true</span>
<span class="key">- format:</span> <span class="val-str">activity-log</span></pre>
  </div>

  <h3 class="text-sm font-semibold text-gray-900 mb-4">Key fields</h3>
  <dl class="space-y-4 text-sm">
    <div>
      <dt class="font-mono text-gray-900">identity_type</dt>
      <dd class="text-gray-500 mt-0.5">The single most consequential field. <code class="font-mono text-gray-700">service-account</code> means the agent has its own credentials and identity. <code class="font-mono text-gray-700">user-proxy</code> means it acts as you — and is subject to the same restrictions.</dd>
    </div>
    <div>
      <dt class="font-mono text-gray-900">pause_trigger / resume_trigger</dt>
      <dd class="text-gray-500 mt-0.5"><code class="font-mono text-gray-700">shkia</code>, <code class="font-mono text-gray-700">candle-lighting</code>, <code class="font-mono text-gray-700">tzait</code>, <code class="font-mono text-gray-700">havdalah</code>, or an ISO 8601 time. Times are computed from accurate zmanim for the configured timezone.</dd>
    </div>
    <div>
      <dt class="font-mono text-gray-900">life_safety_override</dt>
      <dd class="text-gray-500 mt-0.5">Set <code class="font-mono text-gray-700">true</code> for medical or emergency systems only. Pikuach nefesh overrides all of Shabbat by unanimous halachic consensus.</dd>
    </div>
  </dl>
</section>

<!-- PSAK -->
<section id="psak" class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">The Ruling</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-3">The Psak</h2>
  <p class="text-gray-500 text-sm mb-10 max-w-lg">
    A Shabbat-aware agent reads your SHABBAT.md and issues one of three verdicts before the
    Shabbat window begins. No surprises at sunset.
  </p>

  <div class="space-y-8 text-sm">
    <div>
      <p class="font-semibold text-green-600 mb-2">
        <span class="verdict-dot bg-green-500 inline-block"></span>MUTAR — Permitted
      </p>
      <p class="text-gray-500 mb-3">All conditions are met. The agent may run through Shabbat.</p>
      <ul class="text-gray-500 space-y-1 pl-4">
        <li>Agent has its own identity and credentials</li>
        <li>Last prompt was issued before shkia</li>
        <li>No HITL checkpoint fires during Shabbat</li>
        <li>Scope is read-only or actions were pre-authorized</li>
      </ul>
    </div>

    <div>
      <p class="font-semibold text-yellow-600 mb-2">
        <span class="verdict-dot bg-yellow-500 inline-block"></span>SAFEK — Uncertain
      </p>
      <p class="text-gray-500 mb-3">Some criteria unmet or novel edge cases present. Restrict scope. Consult a posek.</p>
      <ul class="text-gray-500 space-y-1 pl-4">
        <li>Mixed identity signals</li>
        <li>Write scope is bounded but present</li>
        <li>Shared infrastructure ownership</li>
        <li>Novel action types without halachic precedent</li>
      </ul>
    </div>

    <div>
      <p class="font-semibold text-red-600 mb-2">
        <span class="verdict-dot bg-red-500 inline-block"></span>ASUR — Forbidden
      </p>
      <p class="text-gray-500 mb-3">One or more hard stops. Pause the agent before shkia on Friday.</p>
      <ul class="text-gray-500 space-y-1 pl-4">
        <li>Agent authenticates as the user in any form</li>
        <li>Requires human prompting during Shabbat</li>
        <li>Performs financial or destructive operations</li>
        <li>Sends communications on the user's behalf</li>
      </ul>
    </div>
  </div>

  <div class="mt-10 pt-6 border-t border-gray-100 text-sm text-gray-500">
    <span class="font-medium text-gray-700">Pikuach nefesh override</span> —
    If the agent is part of a life-safety system, set
    <code class="font-mono text-gray-700">life_safety_override: true</code>.
    Pikuach nefesh overrides all of Shabbat. No psak required.
  </div>
</section>

<!-- MELACHOT -->
<section id="melachot" class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">Halachic Mapping</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-3">The 39 Melachot, applied to compute</h2>
  <p class="text-gray-500 text-sm mb-8 max-w-lg">
    Shabbat prohibits 39 categories of creative labor. The relevant ones map cleanly to what AI agents do.
  </p>

  <table class="w-full text-sm">
    <thead>
      <tr class="border-b border-gray-200 text-left">
        <th scope="col" class="pb-3 font-medium text-gray-900 pr-8">Melachah</th>
        <th scope="col" class="pb-3 font-medium text-gray-900 pr-8">Compute equivalent</th>
        <th scope="col" class="pb-3 font-medium text-gray-900 text-right">Verdict</th>
      </tr>
    </thead>
    <tbody class="divide-y divide-gray-100">
      <% [
        { m: "Kotev",          sub: "writing",         compute: "Writing files, committing code, DB inserts",       v: "ASUR",  vc: "text-red-600" },
        { m: "Boneh",          sub: "building",        compute: "Deploying infra, provisioning resources",           v: "ASUR",  vc: "text-red-600" },
        { m: "Makeh b'patish", sub: "finishing blow",  compute: "Shipping a release, completing a build",           v: "ASUR",  vc: "text-red-600" },
        { m: "Mochek",         sub: "erasing",         compute: "Deleting records, files, rm -rf",                  v: "ASUR",  vc: "text-red-600" },
        { m: "Mekach u'memkar",sub: "commerce",        compute: "Billing events, financial transactions",           v: "ASUR",  vc: "text-red-600" },
        { m: "Borer",          sub: "selecting",       compute: "Filtering, ranking, recommendation serving",        v: "SAFEK", vc: "text-yellow-600" },
        { m: "Tzad",           sub: "trapping",        compute: "Scraping, capturing live external data",           v: "SAFEK", vc: "text-yellow-600" },
        { m: "Kore",           sub: "reading",         compute: "Read-only queries, browsing, log analysis",        v: "MUTAR", vc: "text-green-600" },
      ].each do |r| %>
      <tr>
        <td class="py-3 pr-8 text-gray-900">
          <%= r[:m] %> <span class="text-gray-400 text-xs">(<%= r[:sub] %>)</span>
        </td>
        <td class="py-3 pr-8 text-gray-500"><%= r[:compute] %></td>
        <td class="py-3 text-right font-mono text-xs <%= r[:vc] %>"><%= r[:v] %></td>
      </tr>
      <% end %>
    </tbody>
  </table>
</section>

<!-- EXAMPLES -->
<section class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">Examples</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-8">Example rulings</h2>

  <div class="space-y-4 text-sm">
    <% [
      { s: "Read-only monitoring agent — own creds, pre-prompted Friday, no HITL",               v: "MUTAR", vc: "text-green-600" },
      { s: "LLM summarizer processing incoming emails, no replies sent",                          v: "MUTAR", vc: "text-green-600" },
      { s: "On-call alerting agent for a medical device platform",                               v: "MUTAR", vc: "text-green-600", note: "pikuach nefesh" },
      { s: "CI/CD bot with own service account — deploys on merge during Shabbat window",        v: "SAFEK", vc: "text-yellow-600" },
      { s: "Coding agent that opens PRs and commits — runs as the user's GitHub identity",       v: "ASUR",  vc: "text-red-600" },
      { s: "Financial reconciliation agent that processes billing on Shabbat",                   v: "ASUR",  vc: "text-red-600" },
      { s: "Agent that asks user for approval mid-task (HITL checkpoint on Saturday)",           v: "ASUR",  vc: "text-red-600" },
    ].each do |r| %>
    <div class="flex items-start justify-between gap-6">
      <p class="text-gray-500">
        <%= r[:s] %>
        <% if r[:note] %><span class="text-gray-400 font-mono text-xs ml-1">· <%= r[:note] %></span><% end %>
      </p>
      <span class="font-mono text-xs <%= r[:vc] %> shrink-0 mt-0.5"><%= r[:v] %></span>
    </div>
    <% end %>
  </div>
</section>

<!-- HOW TO USE -->
<section id="howto" class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">Getting Started</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-8">How to use</h2>

  <ol class="space-y-6 text-sm text-gray-500 list-decimal list-inside marker:text-gray-300 marker:font-mono">
    <li>
      <span class="text-gray-700 font-medium">Add SHABBAT.md to your repo</span> —
      place it at the root. Most Shabbat-aware agents find it automatically.
    </li>
    <li>
      <span class="text-gray-700 font-medium">Declare the agent's identity</span> —
      set <code class="font-mono text-gray-700">identity_type</code>. This single field determines whether amirah l'akum concerns apply.
    </li>
    <li>
      <span class="text-gray-700 font-medium">Define the Shabbat window</span> —
      set your timezone. The agent computes accurate <em>zmanim</em> for pause and resume.
    </li>
    <li>
      <span class="text-gray-700 font-medium">Scope permitted and forbidden actions</span> —
      list what the agent may do. Map each capability to the melachot table above. When in doubt, leave it out.
    </li>
    <li>
      <span class="text-gray-700 font-medium">Enable the Havdalah Audit</span> —
      after Shabbat, the agent surfaces a log of all actions taken during the window. Review it.
    </li>
  </ol>

  <div class="mt-10">
    <p class="text-xs font-mono text-gray-500 mb-3">Shabbos Clock pattern</p>
    <div class="code-block mb-6">
      <pre><span class="comment"># pip install zmanim</span>
<span class="key">from</span> zmanim <span class="key">import</span> Zmanim

zmanim = Zmanim(geo=user_location, date=friday)
agent.pause_at  = zmanim.shkia()
agent.resume_at = zmanim.tzait_hakochavim(saturday)</pre>
    </div>

    <p class="text-xs font-mono text-gray-500 mb-3">Scope lock before Shabbat</p>
    <div class="code-block">
      <pre>{
  <span class="key">"shabbat_mode"</span>:    <span class="val-bool">true</span>,
  <span class="key">"allowed_tools"</span>:   [<span class="val-str">"read"</span>, <span class="val-str">"search"</span>, <span class="val-str">"summarize"</span>],
  <span class="key">"forbidden_tools"</span>: [<span class="val-str">"write"</span>, <span class="val-str">"deploy"</span>, <span class="val-str">"delete"</span>, <span class="val-str">"commit"</span>, <span class="val-str">"charge"</span>],
  <span class="key">"hitl_disabled"</span>:   <span class="val-bool">true</span>,
  <span class="key">"resume_at"</span>:       <span class="val-str">"&lt;havdalah_iso8601&gt;"</span>
}</pre>
    </div>
  </div>
</section>

<!-- FAQ -->
<section id="faq" class="max-w-2xl mx-auto px-6 py-16 border-t border-gray-100">
  <p class="text-xs font-mono text-gray-500 uppercase tracking-widest mb-8">She'elot u'Teshuvot</p>
  <h2 class="text-xl font-semibold text-gray-900 mb-8">FAQ</h2>

  <div class="space-y-8 text-sm">
    <% [
      {
        q: "Is SHABBAT.md a halachic authority?",
        a: "No. It is a configuration format and a framework for asking the right questions. It can identify the question; it cannot replace a qualified posek. Novel edge cases — and AI agents are genuinely new territory — require a rabbi familiar with technology. This file tells you to consult one when you're in SAFEK territory."
      },
      {
        q: "What if my agent needs to run during Shabbat for a genuine emergency?",
        a: "Set life_safety_override: true. Pikuach nefesh overrides all of Shabbat by unanimous halachic consensus. This field is intentionally not gated — emergencies don't wait for configuration reviews."
      },
      {
        q: "Does this apply to Yom Tov too?",
        a: "Set observe_yom_tov: true. The same framework applies. Some melachot are permitted on Yom Tov when directly serving human needs (ochel nefesh), but their compute equivalents are narrow. The format errs conservative unless you explicitly expand the permitted list."
      },
      {
        q: "What's the difference between shkia and candle-lighting as pause_trigger?",
        a: "Shkia is halachic sunset — the technical start of Shabbat. Candle-lighting is typically 18 minutes earlier, a custom fence around the boundary. Conservative users may prefer candle-lighting. Both are computed from accurate zmanim for your configured timezone."
      },
      {
        q: "What about an agent in a datacenter I own — shvitat keilim?",
        a: "Shvitat keilim (your tools resting) is a rabbinic concern distinct from melachah. An agent running on infrastructure you own but don't personally operate, under its own identity, is in SAFEK territory. Most contemporary poskim are lenient on passive automation in owned systems started before Shabbat — but consult a rabbi."
      },
      {
        q: "Can I have multiple SHABBAT.md files in a monorepo?",
        a: "Yes. The nearest file to the edited directory takes precedence. This mirrors how AGENTS.md works."
      },
      {
        q: "Are there required fields?",
        a: "Only identity_type and timezone. Everything else has conservative defaults. SHABBAT.md is standard Markdown — no strict schema required."
      },
    ].each do |item| %>
    <div>
      <p class="font-medium text-gray-900 mb-1"><%= item[:q] %></p>
      <p class="text-gray-500 leading-relaxed"><%= item[:a] %></p>
    </div>
    <% end %>
  </div>
</section>

<!-- FOOTER -->
<footer class="max-w-2xl mx-auto px-6 py-12 border-t border-gray-100">
  <div class="flex flex-col md:flex-row items-start md:items-center justify-between gap-4 text-sm text-gray-400">
    <span class="font-mono">SHABBAT.md</span>
    <div class="flex gap-5">
      <a href="https://github.com/mitchellbernstein/shabbat.md" target="_blank" rel="noopener" class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">GitHub</a>
      <a href="https://github.com/mitchellbernstein/shabbat.md/blob/main/LICENSE" target="_blank" rel="noopener" class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">MIT</a>
      <a href="https://github.com/mitchellbernstein/shabbat.md/blob/main/SHABBAT.md" target="_blank" rel="noopener" class="hover:text-blue-600 transition-colors focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-blue-500 focus-visible:ring-offset-2 rounded-sm">Raw spec</a>
    </div>
  </div>
  <p class="text-xs text-gray-500 font-mono mt-6">
    Inspired by @jacob_posel's she'elah and @levie's psak.
    Consult a qualified posek for actual halachic decisions. Shabbat Shalom.
  </p>
</footer>
